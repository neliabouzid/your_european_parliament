{% extends "base.html" %} {% block content %}

<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/procedures.css', v='2')}}"
/>

<div class="font-procedure-detail">
  <div class="background-container">
    <div class="centered-container">
      <div class="photo-credit">
        Â© European Union 2025 - Source : EP, Fred MARVAUX
      </div>
      <div class="title-box">
        <div class="title">{{ position.title }}</div>
        <div class="subjects">
          <strong>Subjects:</strong> {{ position.subjects|join('; ') }}
        </div>
        <div class="stage">
          <strong>Stage reached:</strong> {{ position.stage }}
        </div>
        <div class="reference">
          <strong>Reference:</strong> {{ position.reference }}
        </div>
      </div>
    </div>
  </div>

  <div class="main-page-layout centered-container">
    <div class="left-column">
      <h1>Commission's Proposal Summary</h1>
      <p>{{ position.proposal_summary }}</p>

      <h1>Final Act Summary</h1>
      <p>{{ position.final_act_summary }}</p>

      <div class="content-box">
        <h2 class="box-title">
          Follow the procedure throughout its key events:
        </h2>
        {% if key_events_data %}
        <table class="custom-table event-table-fixed">
          <thead>
            <tr>
              <th style="width: 400px">Event</th>
              <th style="width: 100px; text-align: center">Date</th>
            </tr>
          </thead>
          <tbody>
            {% for event_name, event_details in key_events_data.items() %}
            <tr>
              <td style="width: 400px">
                {{ event_name }} {% set first_ref = event_details.Reference |
                first if event_details.Reference else none %} {% if first_ref
                and first_ref.href %}
                <div class="hover-link">
                  <a
                    href="{{ first_ref.href }}"
                    target="_blank"
                    class="event-link"
                    ><strong>View Reference</strong></a
                  >
                </div>
                {% endif %}
              </td>
              <td class="date-cell" style="width: 100px">
                {{ event_details.Date or "N/A" }}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p class="text-muted">No structured key events available.</p>
        {% endif %}
      </div>
    </div>

    <div class="right-sidebar-column">
      <div class="content-box">
        <h2 class="box-title">Key Players</h2>
        {% for institution, data in key_players_data.items() %}
        <div class="institution-section">
          <h3 class="institution-header">{{ institution }}</h3>
          {% if data is mapping and data %}
          <table class="custom-table mb-3">
            <tbody>
              {% for key, value in data.items() %}
              <tr>
                <th style="width: 140px">{{ key }}</th>
                <td>
                  {% if value is iterable and value is not string %}{{
                  value|join(', ') }}{% else %}{{ value or "Not specified" }}{%
                  endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% elif data is iterable and data is not string and data %} {% for
          item in data %} {% if item is mapping %}
          <table class="custom-table mb-3">
            <tbody>
              {% for key, value in item.items() %}
              <tr>
                <th style="width: 140px">{{ key }}</th>
                <td>
                  {% if value is iterable and value is not string %}{{
                  value|join(', ') }}{% else %}{{ value or "Not specified" }}{%
                  endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% endif %} {% endfor %} {% endif %}
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
